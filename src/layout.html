<!DOCTYPE html>
<html lang="fr">
<head>
    <title>EDC - KIOSK - HOME</title>
    <link rel="stylesheet" href="../src/style.css">
    <link rel="stylesheet" href="../src/swiper.css"/>
</head>
<body>
    <div class="header">
        <button class="edc-bg-yellow edc-button edc-button-1" style="visibility: hidden" id="homeBtn" onclick="loadContentIndex()">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                    <path fill="black" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
            </div>
            <span class="edc-muted-text">Aller vers</span>
            <span class="edc-msg-btn">Page d'accueil</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-2">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
            <span class="edc-msg-btn">Espace fidélité</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-3" onclick="loadContentEntreprise()">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
            <span class="edc-msg-btn">L'entreprise</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-4" onclick="loadContentPromotions()">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
            <span class="edc-msg-btn">Les promotions</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-5">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
            <span class="edc-msg-btn">Jeux concours</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-6">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
            <span class="edc-msg-btn">Sondages</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-7">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                </svg>
            </div>
            <span class="edc-msg-btn">Mode enfant</span>
        </button>
        <button class="edc-bg-yellow edc-button edc-button-flag">
            <div class="edc-button-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="-10 -10 3020 2020">
                    <g id="french_flag">
                        <rect fill="rgb(0%,14%,58%)" x="0" y="0" width="1010" height="2000" />
                        <rect fill="rgb(97%,97%,97%)" x="1000" y="0" width="1010" height="2000" />
                        <rect fill="rgb(93%,16%,22%)" x="2000" y="0" width="1000" height="2000" />
                        <rect fill="none" stroke="rgb(55%,55%,55%)" stroke-width="10" x="0" y="0" width="3000" height="2000" />
                    </g>
                </svg>
            </div>
            <span class="edc-flag-name">Français</span>
        </button>
    </div>

    <div class="edc-content" id="content">

    </div>

    <div id="edc-promotions" style="visibility: hidden;">
        <div class="swiper mySwiper" style="position: fixed; margin-top: 150px">
            <div class="swiper-wrapper" id="swiper-wrapper">

            </div>
            <div class="swiper-pagination"></div>
        </div>
    </div>

    <div class="edc-footer">
        <div class="edc-footer-clock">
            <div class="edc-footer-clock-date"></div>
            <div class="edc-footer-clock-hours"></div>
            <div class="edc-footer-logo">
                <img src="../assets/logo.jpg" alt="" width="180" height="100">
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <script>

        const ipcRenderer = require('electron').ipcRenderer
        const log = require('electron-log')
        const getPromotionLog = log.scope('promotion_update')
        const schedule = require('node-schedule')
        schedule.scheduleJob('0 0 * * * ', () => {
            loadPromotions()
        })
        // Base de données
        const mysql = require('mysql')
        // DOM
        const homeBtn = document.getElementById("homeBtn")
        const content = document.getElementById("content")
        const promotion = document.getElementById("edc-promotions")
        let html = ''

        const connection = mysql.createConnection({
            host     : "lf269054-001.eu.clouddb.ovh.net",
            user     : "edc-kiosk",
            password : "RWCa6uiJ", // or the original password : 'apaswword'
            database : "kiosk",
            port     : "35823"
        });

        function loadPromotions() {
            connection.connect(function(err) {
                // in case of error
                if(err){
                    getPromotionLog.error('Une erreur est survenue ' + err)
                } else {
                    getPromotionLog.info('Connexion à la BDD établie');
                }
            });

            const query = "SELECT * FROM `promotions`"

            connection.query(query, function(err, rows, fields) {
                if(err){
                    getPromotionLog.error("Une erreur est survenue")
                } else {
                    rows.forEach(function (row) {
                        html += '<div class="swiper-slide">'
                        html += '<div class="title">' + row.title + '</div>'
                        html += '<div class="text">'
                        html += '<p>'
                        html += row.content
                        html += '</p>'
                        html += '<div class="subtitle">' + row.new_price + '€ / ' + row.unite + ' au lieu de <span class="edc-slice-text">' + row.last_price + '€ / ' + row.unite + '</span> </div>'
                        html += '</div>'
                        html += '<img src="' + row.image + '" />'
                        html += '</div>'
                    })
                    document.getElementById('swiper-wrapper').innerHTML = html
                    const swiper = new Swiper('.mySwiper', {
                        loop: true,
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true,
                        },
                        autoplay: {
                            delay: 15000,
                            disableOnInteraction: false,
                        },
                    })
                }
            })

            connection.end(function(){
                getPromotionLog.info('Déconnexion de la BDD');
            });
        }

        loadPromotions()

        function startTime() {
            const today = new Date();
            const h = today.getHours();
            let m = today.getMinutes();
            m = checkTime(m);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }
            const string = today.toLocaleDateString('fr-FR', options)
            document.getElementsByClassName('edc-footer-clock-hours')[0].textContent = h + ":" + m
            document.getElementsByClassName('edc-footer-clock-date')[0].textContent = string[0].toUpperCase() + string.slice(1)
        }

        function checkTime(i) {
            if (i < 10) {i = "0" + i}  // add zero in front of numbers < 10
            return i;
        }

        setInterval(startTime, 500)

        function loadContentEntreprise() {
            homeBtn.style.visibility = "visible"
            promotion.style.visibility = 'hidden'
            fetch('../src/entreprise.html').then((response) => {
                response.text().then((html) => {
                    content.innerHTML = html
                })
            })
        }

        function loadContentIndex() {
            homeBtn.style.visibility = "hidden"
            promotion.style.visibility = 'hidden'
            fetch('../src/index.html').then((response) => {
                response.text().then((html) => {
                    content.innerHTML = html
                })
            })
        }

        function loadContentPromotions() {
            homeBtn.style.visibility = "visible"
            promotion.style.visibility = 'visible'
            content.innerHTML = ''
        }

    </script>

</body>
</html>